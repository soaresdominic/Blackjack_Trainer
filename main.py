import random
from datetime import datetime
from tracemalloc import start

"""
Basic strategy trainer for blackjack with multiple decks. All permutations of cards are simulated, with the correct move assigned to each permutation
s = stand
p = split
h = hit
d = double
"""

## card_combos = list(dict.fromkeys(itertools.permutations(["2", "3", "4", "5", "6", "7", "8", "9", "10", "A"], r=2)))

# first two are dealt cards, next is dealer's up card, last is answer
card_combos = [('2', '2', '2', 'h'), ('2', '2', '3', 'h'), ('2', '2', '4', 'p'), ('2', '2', '5', 'p'), ('2', '2', '6', 'p'), ('2', '2', '7', 'p'), ('2', '2', '8', 'h'), ('2', '2', '9', 'h'), ('2', '2', '10', 'h'), ('2', '2', 'A', 'h'), ('2', '3', '2', 'h'), ('2', '3', '3', 'h'), ('2', '3', '4', 'h'), ('2', '3', '5', 'h'), ('2', '3', '6', 'h'), ('2', '3', '7', 'h'), ('2', '3', '8', 'h'), ('2', '3', '9', 'h'), ('2', '3', '10', 'h'), ('2', '3', 'A', 'h'), ('2', '4', '2', 'h'), ('2', '4', '3', 'h'), ('2', '4', '4', 'h'), ('2', '4', '5', 'h'), ('2', '4', '6', 'h'), ('2', '4', '7', 'h'), ('2', '4', '8', 'h'), ('2', '4', '9', 'h'), ('2', '4', '10', 'h'), ('2', '4', 'A', 'h'), ('2', '5', '2', 'h'), ('2', '5', '3', 'h'), ('2', '5', '4', 'h'), ('2', '5', '5', 'h'), ('2', '5', '6', 'h'), ('2', '5', '7', 'h'), ('2', '5', '8', 'h'), ('2', '5', '9', 'h'), ('2', '5', '10', 'h'), ('2', '5', 'A', 'h'), ('2', '6', '2', 'h'), ('2', '6', '3', 'h'), ('2', '6', '4', 'h'), ('2', '6', '5', 'h'), ('2', '6', '6', 'h'), ('2', '6', '7', 'h'), ('2', '6', '8', 'h'), ('2', '6', '9', 'h'), ('2', '6', '10', 'h'), ('2', '6', 'A', 'h'), ('2', '7', '2', 'h'), ('2', '7', '3', 'd'), ('2', '7', '4', 'd'), ('2', '7', '5', 'd'), ('2', '7', '6', 'd'), ('2', '7', '7', 'h'), ('2', '7', '8', 'h'), ('2', '7', '9', 'h'), ('2', '7', '10', 'h'), ('2', '7', 'A', 'h'), ('2', '8', '2', 'd'), ('2', '8', '3', 'd'), ('2', '8', '4', 'd'), ('2', '8', '5', 'd'), ('2', '8', '6', 'd'), ('2', '8', '7', 'd'), ('2', '8', '8', 'd'), ('2', '8', '9', 'd'), ('2', '8', '10', 'h'), ('2', '8', 'A', 'h'), ('2', '9', '2', 'd'), ('2', '9', '3', 'd'), ('2', '9', '4', 'd'), ('2', '9', '5', 'd'), ('2', '9', '6', 'd'), ('2', '9', '7', 'd'), ('2', '9', '8', 'd'), ('2', '9', '9', 'd'), ('2', '9', '10', 'd'), ('2', '9', 'A', 'h'), ('2', '10', '2', 'h'), ('2', '10', '3', 'h'), ('2', '10', '4', 's'), ('2', '10', '5', 's'), ('2', '10', '6', 's'), ('2', '10', '7', 'h'), ('2', '10', '8', 'h'), ('2', '10', '9', 'h'), ('2', '10', '10', 'h'), ('2', '10', 'A', 'h'), ('2', 'A', '2', 'h'), ('2', 'A', '3', 'h'), ('2', 'A', '4', 'h'), ('2', 'A', '5', 'd'), ('2', 'A', '6', 'd'), ('2', 'A', '7', 'h'), ('2', 'A', '8', 'h'), ('2', 'A', '9', 'h'), ('2', 'A', '10', 'h'), ('2', 'A', 'A', 'h'), ('3', '3', '2', 'h'), ('3', '3', '3', 'h'), ('3', '3', '4', 'p'), ('3', '3', '5', 'p'), ('3', '3', '6', 'p'), ('3', '3', '7', 'p'), ('3', '3', '8', 'h'), ('3', '3', '9', 'h'), ('3', '3', '10', 'h'), ('3', '3', 'A', 'h'), ('3', '4', '2', 'h'), ('3', '4', '3', 'h'), ('3', '4', '4', 'h'), ('3', '4', '5', 'h'), ('3', '4', '6', 'h'), ('3', '4', '7', 'h'), ('3', '4', '8', 'h'), ('3', '4', '9', 'h'), ('3', '4', '10', 'h'), ('3', '4', 'A', 'h'), ('3', '5', '2', 'h'), ('3', '5', '3', 'h'), ('3', '5', '4', 'h'), ('3', '5', '5', 'h'), ('3', '5', '6', 'h'), ('3', '5', '7', 'h'), ('3', '5', '8', 'h'), ('3', '5', '9', 'h'), ('3', '5', '10', 'h'), ('3', '5', 'A', 'h'), ('3', '6', '2', 'h'), ('3', '6', '3', 'd'), ('3', '6', '4', 'd'), ('3', '6', '5', 'd'), ('3', '6', '6', 'd'), ('3', '6', '7', 'h'), ('3', '6', '8', 'h'), ('3', '6', '9', 'h'), ('3', '6', '10', 'h'), ('3', '6', 'A', 'h'), ('3', '7', '2', 'd'), ('3', '7', '3', 'd'), ('3', '7', '4', 'd'), ('3', '7', '5', 'd'), ('3', '7', '6', 'd'), ('3', '7', '7', 'd'), ('3', '7', '8', 'd'), ('3', '7', '9', 'd'), ('3', '7', '10', 'h'), ('3', '7', 'A', 'h'), ('3', '8', '2', 'd'), ('3', '8', '3', 'd'), ('3', '8', '4', 'd'), ('3', '8', '5', 'd'), ('3', '8', '6', 'd'), ('3', '8', '7', 'd'), ('3', '8', '8', 'd'), ('3', '8', '9', 'd'), ('3', '8', '10', 'd'), ('3', '8', 'A', 'h'), ('3', '9', '2', 'h'), ('3', '9', '3', 'h'), ('3', '9', '4', 's'), ('3', '9', '5', 's'), ('3', '9', '6', 's'), ('3', '9', '7', 'h'), ('3', '9', '8', 'h'), ('3', '9', '9', 'h'), ('3', '9', '10', 'h'), ('3', '9', 'A', 'h'), ('3', '10', '2', 's'), ('3', '10', '3', 's'), ('3', '10', '4', 's'), ('3', '10', '5', 's'), ('3', '10', '6', 's'), ('3', '10', '7', 'h'), ('3', '10', '8', 'h'), ('3', '10', '9', 'h'), ('3', '10', '10', 'h'), ('3', '10', 'A', 'h'), ('3', 'A', '2', 'h'), ('3', 'A', '3', 'h'), ('3', 'A', '4', 'h'), ('3', 'A', '5', 'd'), ('3', 'A', '6', 'd'), ('3', 'A', '7', 'h'), ('3', 'A', '8', 'h'), ('3', 'A', '9', 'h'), ('3', 'A', '10', 'h'), ('3', 'A', 'A', 'h'), ('4', '4', '2', 'h'), ('4', '4', '3', 'h'), ('4', '4', '4', 'h'), ('4', '4', '5', 'h'), ('4', '4', '6', 'h'), ('4', '4', '7', 'h'), ('4', '4', '8', 'h'), ('4', '4', '9', 'h'), ('4', '4', '10', 'h'), ('4', '4', 'A', 'h'), ('4', '5', '2', 'h'), ('4', '5', '3', 'd'), ('4', '5', '4', 'd'), ('4', '5', '5', 'd'), ('4', '5', '6', 'd'), ('4', '5', '7', 'h'), ('4', '5', '8', 'h'), ('4', '5', '9', 'h'), ('4', '5', '10', 'h'), ('4', '5', 'A', 'h'), ('4', '6', '2', 'd'), ('4', '6', '3', 'd'), ('4', '6', '4', 'd'), ('4', '6', '5', 'd'), ('4', '6', '6', 'd'), ('4', '6', '7', 'd'), ('4', '6', '8', 'd'), ('4', '6', '9', 'd'), ('4', '6', '10', 'h'), ('4', '6', 'A', 'h'), ('4', '7', '2', 'd'), ('4', '7', '3', 'd'), ('4', '7', '4', 'd'), ('4', '7', '5', 'd'), ('4', '7', '6', 'd'), ('4', '7', '7', 'd'), ('4', '7', '8', 'd'), ('4', '7', '9', 'd'), ('4', '7', '10', 'd'), ('4', '7', 'A', 'h'), ('4', '8', '2', 'h'), ('4', '8', '3', 'h'), ('4', '8', '4', 's'), ('4', '8', '5', 's'), ('4', '8', '6', 's'), ('4', '8', '7', 'h'), ('4', '8', '8', 'h'), ('4', '8', '9', 'h'), ('4', '8', '10', 'h'), ('4', '8', 'A', 'h'), ('4', '9', '2', 's'), ('4', '9', '3', 's'), ('4', '9', '4', 's'), ('4', '9', '5', 's'), ('4', '9', '6', 's'), ('4', '9', '7', 'h'), ('4', '9', '8', 'h'), ('4', '9', '9', 'h'), ('4', '9', '10', 'h'), ('4', '9', 'A', 'h'), ('4', '10', '2', 's'), ('4', '10', '3', 's'), ('4', '10', '4', 's'), ('4', '10', '5', 's'), ('4', '10', '6', 's'), ('4', '10', '7', 'h'), ('4', '10', '8', 'h'), ('4', '10', '9', 'h'), ('4', '10', '10', 'h'), ('4', '10', 'A', 'h'), ('4', 'A', '2', 'h'), ('4', 'A', '3', 'h'), ('4', 'A', '4', 'd'), ('4', 'A', '5', 'd'), ('4', 'A', '6', 'd'), ('4', 'A', '7', 'h'), ('4', 'A', '8', 'h'), ('4', 'A', '9', 'h'), ('4', 'A', '10', 'h'), ('4', 'A', 'A', 'h'), ('5', '5', '2', 'd'), ('5', '5', '3', 'd'), ('5', '5', '4', 'd'), ('5', '5', '5', 'd'), ('5', '5', '6', 'd'), ('5', '5', '7', 'd'), ('5', '5', '8', 'd'), ('5', '5', '9', 'd'), ('5', '5', '10', 'h'), ('5', '5', 'A', 'h'), ('5', '6', '2', 'd'), ('5', '6', '3', 'd'), ('5', '6', '4', 'd'), ('5', '6', '5', 'd'), ('5', '6', '6', 'd'), ('5', '6', '7', 'd'), ('5', '6', '8', 'd'), ('5', '6', '9', 'd'), ('5', '6', '10', 'd'), ('5', '6', 'A', 'h'), ('5', '7', '2', 'h'), ('5', '7', '3', 'h'), ('5', '7', '4', 's'), ('5', '7', '5', 's'), ('5', '7', '6', 's'), ('5', '7', '7', 'h'), ('5', '7', '8', 'h'), ('5', '7', '9', 'h'), ('5', '7', '10', 'h'), ('5', '7', 'A', 'h'), ('5', '8', '2', 's'), ('5', '8', '3', 's'), ('5', '8', '4', 's'), ('5', '8', '5', 's'), ('5', '8', '6', 's'), ('5', '8', '7', 'h'), ('5', '8', '8', 'h'), ('5', '8', '9', 'h'), ('5', '8', '10', 'h'), ('5', '8', 'A', 'h'), ('5', '9', '2', 's'), ('5', '9', '3', 's'), ('5', '9', '4', 's'), ('5', '9', '5', 's'), ('5', '9', '6', 's'), ('5', '9', '7', 'h'), ('5', '9', '8', 'h'), ('5', '9', '9', 'h'), ('5', '9', '10', 'h'), ('5', '9', 'A', 'h'), ('5', '10', '2', 's'), ('5', '10', '3', 's'), ('5', '10', '4', 's'), ('5', '10', '5', 's'), ('5', '10', '6', 's'), ('5', '10', '7', 'h'), ('5', '10', '8', 'h'), ('5', '10', '9', 'h'), ('5', '10', '10', 'h'), ('5', '10', 'A', 'h'), ('5', 'A', '2', 'h'), ('5', 'A', '3', 'h'), ('5', 'A', '4', 'd'), ('5', 'A', '5', 'd'), ('5', 'A', '6', 'd'), ('5', 'A', '7', 'h'), ('5', 'A', '8', 'h'), ('5', 'A', '9', 'h'), ('5', 'A', '10', 'h'), ('5', 'A', 'A', 'h'), ('6', '6', '2', 'h'), ('6', '6', '3', 'p'), ('6', '6', '4', 'p'), ('6', '6', '5', 'p'), ('6', '6', '6', 'p'), ('6', '6', '7', 'h'), ('6', '6', '8', 'h'), ('6', '6', '9', 'h'), ('6', '6', '10', 'h'), ('6', '6', 'A', 'h'), ('6', '7', '2', 's'), ('6', '7', '3', 's'), ('6', '7', '4', 's'), ('6', '7', '5', 's'), ('6', '7', '6', 's'), ('6', '7', '7', 'h'), ('6', '7', '8', 'h'), ('6', '7', '9', 'h'), ('6', '7', '10', 'h'), ('6', '7', 'A', 'h'), ('6', '8', '2', 's'), ('6', '8', '3', 's'), ('6', '8', '4', 's'), ('6', '8', '5', 's'), ('6', '8', '6', 's'), ('6', '8', '7', 'h'), ('6', '8', '8', 'h'), ('6', '8', '9', 'h'), ('6', '8', '10', 'h'), ('6', '8', 'A', 'h'), ('6', '9', '2', 's'), ('6', '9', '3', 's'), ('6', '9', '4', 's'), ('6', '9', '5', 's'), ('6', '9', '6', 's'), ('6', '9', '7', 'h'), ('6', '9', '8', 'h'), ('6', '9', '9', 'h'), ('6', '9', '10', 'h'), ('6', '9', 'A', 'h'), ('6', '10', '2', 's'), ('6', '10', '3', 's'), ('6', '10', '4', 's'), ('6', '10', '5', 's'), ('6', '10', '6', 's'), ('6', '10', '7', 'h'), ('6', '10', '8', 'h'), ('6', '10', '9', 'h'), ('6', '10', '10', 'h'), ('6', '10', 'A', 'h'), ('6', 'A', '2', 'h'), ('6', 'A', '3', 'd'), ('6', 'A', '4', 'd'), ('6', 'A', '5', 'd'), ('6', 'A', '6', 'd'), ('6', 'A', '7', 'h'), ('6', 'A', '8', 'h'), ('6', 'A', '9', 'h'), ('6', 'A', '10', 'h'), ('6', 'A', 'A', 'h'), ('7', '7', '2', 'p'), ('7', '7', '3', 'p'), ('7', '7', '4', 'p'), ('7', '7', '5', 'p'), ('7', '7', '6', 'p'), ('7', '7', '7', 'p'), ('7', '7', '8', 'h'), ('7', '7', '9', 'h'), ('7', '7', '10', 'h'), ('7', '7', 'A', 'h'), ('7', '8', '2', 's'), ('7', '8', '3', 's'), ('7', '8', '4', 's'), ('7', '8', '5', 's'), ('7', '8', '6', 's'), ('7', '8', '7', 'h'), ('7', '8', '8', 'h'), ('7', '8', '9', 'h'), ('7', '8', '10', 'h'), ('7', '8', 'A', 'h'), ('7', '9', '2', 's'), ('7', '9', '3', 's'), ('7', '9', '4', 's'), ('7', '9', '5', 's'), ('7', '9', '6', 's'), ('7', '9', '7', 'h'), ('7', '9', '8', 'h'), ('7', '9', '9', 'h'), ('7', '9', '10', 'h'), ('7', '9', 'A', 'h'), ('7', '10', '2', 's'), ('7', '10', '3', 's'), ('7', '10', '4', 's'), ('7', '10', '5', 's'), ('7', '10', '6', 's'), ('7', '10', '7', 's'), ('7', '10', '8', 's'), ('7', '10', '9', 's'), ('7', '10', '10', 's'), ('7', '10', 'A', 's'), ('7', 'A', '2', 's'), ('7', 'A', '3', 'd'), ('7', 'A', '4', 'd'), ('7', 'A', '5', 'd'), ('7', 'A', '6', 'd'), ('7', 'A', '7', 's'), ('7', 'A', '8', 's'), ('7', 'A', '9', 'h'), ('7', 'A', '10', 'h'), ('7', 'A', 'A', 'h'), ('8', '8', '2', 'p'), ('8', '8', '3', 'p'), ('8', '8', '4', 'p'), ('8', '8', '5', 'p'), ('8', '8', '6', 'p'), ('8', '8', '7', 'p'), ('8', '8', '8', 'p'), ('8', '8', '9', 'p'), ('8', '8', '10', 'p'), ('8', '8', 'A', 'p'), ('8', '9', '2', 's'), ('8', '9', '3', 's'), ('8', '9', '4', 's'), ('8', '9', '5', 's'), ('8', '9', '6', 's'), ('8', '9', '7', 's'), ('8', '9', '8', 's'), ('8', '9', '9', 's'), ('8', '9', '10', 's'), ('8', '9', 'A', 's'), ('8', '10', '2', 's'), ('8', '10', '3', 's'), ('8', '10', '4', 's'), ('8', '10', '5', 's'), ('8', '10', '6', 's'), ('8', '10', '7', 's'), ('8', '10', '8', 's'), ('8', '10', '9', 's'), ('8', '10', '10', 's'), ('8', '10', 'A', 's'), ('8', 'A', '2', 's'), ('8', 'A', '3', 's'), ('8', 'A', '4', 's'), ('8', 'A', '5', 's'), ('8', 'A', '6', 's'), ('8', 'A', '7', 's'), ('8', 'A', '8', 's'), ('8', 'A', '9', 's'), ('8', 'A', '10', 's'), ('8', 'A', 'A', 's'), ('9', '9', '2', 'p'), ('9', '9', '3', 'p'), ('9', '9', '4', 'p'), ('9', '9', '5', 'p'), ('9', '9', '6', 'p'), ('9', '9', '7', 's'), ('9', '9', '8', 'p'), ('9', '9', '9', 'p'), ('9', '9', '10', 's'), ('9', '9', 'A', 's'), ('9', '10', '2', 's'), ('9', '10', '3', 's'), ('9', '10', '4', 's'), ('9', '10', '5', 's'), ('9', '10', '6', 's'), ('9', '10', '7', 's'), ('9', '10', '8', 's'), ('9', '10', '9', 's'), ('9', '10', '10', 's'), ('9', '10', 'A', 's'), ('9', 'A', '2', 's'), ('9', 'A', '3', 's'), ('9', 'A', '4', 's'), ('9', 'A', '5', 's'), ('9', 'A', '6', 's'), ('9', 'A', '7', 's'), ('9', 'A', '8', 's'), ('9', 'A', '9', 's'), ('9', 'A', '10', 's'), ('9', 'A', 'A', 's'), ('10', '10', '2', 's'), ('10', '10', '3', 's'), ('10', '10', '4', 's'), ('10', '10', '5', 's'), ('10', '10', '6', 's'), ('10', '10', '7', 's'), ('10', '10', '8', 's'), ('10', '10', '9', 's'), ('10', '10', '10', 's'), ('10', '10', 'A', 's'), ('A', 'A', '2', 'p'), ('A', 'A', '3', 'p'), ('A', 'A', '4', 'p'), ('A', 'A', '5', 'p'), ('A', 'A', '6', 'p'), ('A', 'A', '7', 'p'), ('A', 'A', '8', 'p'), ('A', 'A', '9', 'p'), ('A', 'A', '10', 'p'), ('A', 'A', 'A', 'p')]


# These hold a list of indexes to the massive card_combos array
correct = []
incorrect = list(range(0, len(card_combos)))  # [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, ...]

guessed_incorrectly = []

all_correct = False
while not all_correct:
    # example process for next three lines:
    # incorrect = [0, 1, 6, 9]
    # > index = 2
    # > incorrect_index = 6
    # > cards = ('2', '2', '9')
    index = random.randint(0, len(incorrect) - 1)

    card_combos_index = incorrect[index]  
    cards = card_combos[card_combos_index]

    dealt_cards =  cards[0] + " " + cards[1]
    dealer_face_up = cards[2]
    answer = cards[3]

    while True:
        start_time = datetime.now()
        print("DEALER: ", dealer_face_up)
        print("Dealt: ", dealt_cards)
        guess = input()
        if guess in ['s', 'h', 'd', 'p']:
            break
    end_time = datetime.now()
    time_diff = end_time - start_time
    elapsed_seconds = time_diff.total_seconds()

    if elapsed_seconds >= 5 and guess == answer:
        print("TOO SLOW!", answer, "------")
        if cards not in guessed_incorrectly:
            guessed_incorrectly.append(cards)
    elif guess == answer:
        correct.append(card_combos_index)
        incorrect.remove(card_combos_index)
        print("CORRECT")
    else:
        # incorrect already holds all the original combos, no need to append
        print("INCORRECT: ", answer, "------")
        if cards not in guessed_incorrectly:
            guessed_incorrectly.append(cards)

    if len(correct) == len(card_combos):
        all_correct = True

print("Finished!")
print("Guessed Incorrectly At Least Once: ", guessed_incorrectly)